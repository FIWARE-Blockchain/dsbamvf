<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="3812px" preserveAspectRatio="none" style="width:1935px;height:3812px;background:#FFFFFF;" version="1.1" viewBox="0 0 1935 3812" width="1935px" zoomAndPan="magnify"><defs/><g><rect height="27.6094" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="370" x="784.25" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="360" x="789.25" y="29.5332">Packet Delivery - HappyPets customer changes PTA</text><rect fill="#FFE4E1" height="3755.0938" style="stroke:#00000000;stroke-width:0.5;" width="429" x="90" y="44.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28" x="288.5" y="58.1045">User</text><rect fill="#EBFCEF" height="3755.0938" style="stroke:#00000000;stroke-width:0.5;" width="987" x="645.5" y="44.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="95" x="1089.5" y="58.1045">PacketDelivery</text><rect fill="#FFFFFF" height="262.9219" style="stroke:#181818;stroke-width:1.0;" width="10" x="47" y="816.5781"/><rect fill="#FFFFFF" height="974.1172" style="stroke:#181818;stroke-width:1.0;" width="10" x="243.5" y="475.0078"/><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="472.5" y="196.1406"/><rect fill="#FFFFFF" height="55.7031" style="stroke:#181818;stroke-width:1.0;" width="10" x="472.5" y="256.8438"/><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="472.5" y="444.6563"/><rect fill="#FFFFFF" height="181.1641" style="stroke:#181818;stroke-width:1.0;" width="10" x="472.5" y="2917.625"/><rect fill="#FFFFFF" height="228.1641" style="stroke:#181818;stroke-width:1.0;" width="10" x="700.5" y="3098.7891"/><rect fill="#FFFFFF" height="63.0547" style="stroke:#181818;stroke-width:1.0;" width="10" x="700.5" y="3503.4141"/><rect fill="#FFFFFF" height="126.4063" style="stroke:#181818;stroke-width:1.0;" width="10" x="841.5" y="574.4141"/><rect fill="#FFFFFF" height="700.5469" style="stroke:#181818;stroke-width:1.0;" width="10" x="841.5" y="1449.125"/><rect fill="#FFFFFF" height="164.8125" style="stroke:#181818;stroke-width:1.0;" width="10" x="1034.5" y="1564.8828"/><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="1152.5" y="226.4922"/><rect fill="#FFFFFF" height="132.1094" style="stroke:#181818;stroke-width:1.0;" width="10" x="1152.5" y="312.5469"/><rect fill="#FFFFFF" height="347.9766" style="stroke:#181818;stroke-width:1.0;" width="10" x="1152.5" y="2149.6719"/><rect fill="#FFFFFF" height="191.8125" style="stroke:#181818;stroke-width:1.0;" width="10" x="1152.5" y="2725.8125"/><rect fill="#FFFFFF" height="106.4063" style="stroke:#181818;stroke-width:1.0;" width="10" x="1152.5" y="3566.4688"/><rect fill="#FFFFFF" height="115.7578" style="stroke:#181818;stroke-width:1.0;" width="10" x="1372.5" y="3326.9531"/><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="1372.5" y="3473.0625"/><rect fill="#FFFFFF" height="228.1641" style="stroke:#181818;stroke-width:1.0;" width="10" x="1567.5" y="2497.6484"/><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="1567.5" y="3442.7109"/><rect height="2036.6406" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1213.5" x="10" y="271.8438"/><rect height="1256.6328" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1499.5" x="430" y="2424.2422"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="52" x2="52" y1="163.7891" y2="3697.875"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="147" x2="147" y1="163.7891" y2="3697.875"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="248" x2="248" y1="163.7891" y2="3697.875"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="477" x2="477" y1="163.7891" y2="3697.875"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="705.5" x2="705.5" y1="163.7891" y2="3697.875"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="846.5" x2="846.5" y1="163.7891" y2="3697.875"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1039.5" x2="1039.5" y1="163.7891" y2="3697.875"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1157.5" x2="1157.5" y1="163.7891" y2="3697.875"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1377.5" x2="1377.5" y1="163.7891" y2="3697.875"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1572.5" x2="1572.5" y1="163.7891" y2="3697.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="20" y="143.1035">Universal</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="21" y="160.7129">Resolver</text><path d="M34,92.5703 C34,82.5703 52,82.5703 52,82.5703 C52,82.5703 70,82.5703 70,92.5703 L70,118.5703 C70,128.5703 52,128.5703 52,128.5703 C52,128.5703 34,128.5703 34,118.5703 L34,92.5703 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M34,92.5703 C34,102.5703 52,102.5703 52,102.5703 C52,102.5703 70,102.5703 70,92.5703 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="20" y="3711.4082">Universal</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="21" y="3729.0176">Resolver</text><path d="M34,3742.0938 C34,3732.0938 52,3732.0938 52,3732.0938 C52,3732.0938 70,3732.0938 70,3742.0938 L70,3768.0938 C70,3778.0938 52,3778.0938 52,3778.0938 C52,3778.0938 34,3778.0938 34,3768.0938 L34,3742.0938 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M34,3742.0938 C34,3752.0938 52,3752.0938 52,3752.0938 C52,3752.0938 70,3752.0938 70,3742.0938 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101" x="94" y="160.7129">Prime Customer</text><ellipse cx="147.5" cy="94.6797" fill="#F7A6A6" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M147.5,102.6797 L147.5,129.6797 M134.5,110.6797 L160.5,110.6797 M147.5,129.6797 L134.5,144.6797 M147.5,129.6797 L160.5,144.6797 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101" x="94" y="3711.4082">Prime Customer</text><ellipse cx="147.5" cy="3722.9844" fill="#F7A6A6" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M147.5,3730.9844 L147.5,3757.9844 M134.5,3738.9844 L160.5,3738.9844 M147.5,3757.9844 L134.5,3772.9844 M147.5,3757.9844 L160.5,3772.9844 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F7A6A6" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="75" x="211" y="113.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="218" y="135.1035">Customer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="232.5" y="152.7129">SIOP</text><rect fill="#F7A6A6" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="75" x="211" y="3696.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="218" y="3718.4082">Customer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="232.5" y="3736.0176">SIOP</text><rect fill="#F7A6A6" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="75" x="440" y="113.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="447" y="135.1035">Customer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="452" y="152.7129">Browser</text><rect fill="#F7A6A6" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="75" x="440" y="3696.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="447" y="3718.4082">Customer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="452" y="3736.0176">Browser</text><rect fill="#92E8C6" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112" x="649.5" y="113.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="656.5" y="135.1035">Packet Delivery</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="692" y="152.7129">PEP</text><rect fill="#92E8C6" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112" x="649.5" y="3696.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="656.5" y="3718.4082">Packet Delivery</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="692" y="3736.0176">PEP</text><rect fill="#92E8C6" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112" x="790.5" y="113.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="797.5" y="135.1035">Packet Delivery</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="19" x="837" y="152.7129">RP</text><rect fill="#92E8C6" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112" x="790.5" y="3696.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="797.5" y="3718.4082">Packet Delivery</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="19" x="837" y="3736.0176">RP</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="987.5" y="125.4941">Packet Delivery</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="1007.5" y="143.1035">Universal</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="1008.5" y="160.7129">Resolver</text><path d="M1021.5,74.9609 C1021.5,64.9609 1039.5,64.9609 1039.5,64.9609 C1039.5,64.9609 1057.5,64.9609 1057.5,74.9609 L1057.5,100.9609 C1057.5,110.9609 1039.5,110.9609 1039.5,110.9609 C1039.5,110.9609 1021.5,110.9609 1021.5,100.9609 L1021.5,74.9609 " fill="#92E8C6" style="stroke:#181818;stroke-width:1.5;"/><path d="M1021.5,74.9609 C1021.5,84.9609 1039.5,84.9609 1039.5,84.9609 C1039.5,84.9609 1057.5,84.9609 1057.5,74.9609 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="987.5" y="3711.4082">Packet Delivery</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="1007.5" y="3729.0176">Universal</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="1008.5" y="3746.627">Resolver</text><path d="M1021.5,3759.7031 C1021.5,3749.7031 1039.5,3749.7031 1039.5,3749.7031 C1039.5,3749.7031 1057.5,3749.7031 1057.5,3759.7031 L1057.5,3785.7031 C1057.5,3795.7031 1039.5,3795.7031 1039.5,3795.7031 C1039.5,3795.7031 1021.5,3795.7031 1021.5,3785.7031 L1021.5,3759.7031 " fill="#92E8C6" style="stroke:#181818;stroke-width:1.5;"/><path d="M1021.5,3759.7031 C1021.5,3769.7031 1039.5,3769.7031 1039.5,3769.7031 C1039.5,3769.7031 1057.5,3769.7031 1057.5,3759.7031 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#92E8C6" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112" x="1101.5" y="113.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="1108.5" y="135.1035">Packet Delivery</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="1139" y="152.7129">Portal</text><rect fill="#92E8C6" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112" x="1101.5" y="3696.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="1108.5" y="3718.4082">Packet Delivery</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="1139" y="3736.0176">Portal</text><rect fill="#92E8C6" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112" x="1321.5" y="113.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="1328.5" y="135.1035">Packet Delivery</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="1363.5" y="152.7129">PDP</text><rect fill="#92E8C6" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112" x="1321.5" y="3696.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="1328.5" y="3718.4082">Packet Delivery</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="1363.5" y="3736.0176">PDP</text><rect fill="#92E8C6" height="66.8281" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112" x="1516.5" y="95.9609"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="1523.5" y="117.4941">Packet Delivery</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="1531" y="135.1035">Authorisation</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="1546.5" y="152.7129">Registry</text><rect fill="#92E8C6" height="66.8281" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112" x="1516.5" y="3696.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="1523.5" y="3718.4082">Packet Delivery</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="1531" y="3736.0176">Authorisation</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="1546.5" y="3753.627">Registry</text><rect fill="#FFFFFF" height="262.9219" style="stroke:#181818;stroke-width:1.0;" width="10" x="47" y="816.5781"/><rect fill="#FFFFFF" height="974.1172" style="stroke:#181818;stroke-width:1.0;" width="10" x="243.5" y="475.0078"/><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="472.5" y="196.1406"/><rect fill="#FFFFFF" height="55.7031" style="stroke:#181818;stroke-width:1.0;" width="10" x="472.5" y="256.8438"/><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="472.5" y="444.6563"/><rect fill="#FFFFFF" height="181.1641" style="stroke:#181818;stroke-width:1.0;" width="10" x="472.5" y="2917.625"/><rect fill="#FFFFFF" height="228.1641" style="stroke:#181818;stroke-width:1.0;" width="10" x="700.5" y="3098.7891"/><rect fill="#FFFFFF" height="63.0547" style="stroke:#181818;stroke-width:1.0;" width="10" x="700.5" y="3503.4141"/><rect fill="#FFFFFF" height="126.4063" style="stroke:#181818;stroke-width:1.0;" width="10" x="841.5" y="574.4141"/><rect fill="#FFFFFF" height="700.5469" style="stroke:#181818;stroke-width:1.0;" width="10" x="841.5" y="1449.125"/><rect fill="#FFFFFF" height="164.8125" style="stroke:#181818;stroke-width:1.0;" width="10" x="1034.5" y="1564.8828"/><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="1152.5" y="226.4922"/><rect fill="#FFFFFF" height="132.1094" style="stroke:#181818;stroke-width:1.0;" width="10" x="1152.5" y="312.5469"/><rect fill="#FFFFFF" height="347.9766" style="stroke:#181818;stroke-width:1.0;" width="10" x="1152.5" y="2149.6719"/><rect fill="#FFFFFF" height="191.8125" style="stroke:#181818;stroke-width:1.0;" width="10" x="1152.5" y="2725.8125"/><rect fill="#FFFFFF" height="106.4063" style="stroke:#181818;stroke-width:1.0;" width="10" x="1152.5" y="3566.4688"/><rect fill="#FFFFFF" height="115.7578" style="stroke:#181818;stroke-width:1.0;" width="10" x="1372.5" y="3326.9531"/><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="1372.5" y="3473.0625"/><rect fill="#FFFFFF" height="228.1641" style="stroke:#181818;stroke-width:1.0;" width="10" x="1567.5" y="2497.6484"/><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="1567.5" y="3442.7109"/><polygon fill="#181818" points="460.5,192.1406,470.5,196.1406,460.5,200.1406,464.5,196.1406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147.5" x2="466.5" y1="196.1406" y2="196.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="154.5" y="191.2842">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="165.5" y="191.2842">Access portal</text><polygon fill="#181818" points="1140.5,222.4922,1150.5,226.4922,1140.5,230.4922,1144.5,226.4922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="477.5" x2="1146.5" y1="226.4922" y2="226.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="484.5" y="221.6357">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="495.5" y="221.6357">Accesses portal</text><polygon fill="#181818" points="493.5,252.8438,483.5,256.8438,493.5,260.8438,489.5,256.8438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="487.5" x2="1156.5" y1="256.8438" y2="256.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="499.5" y="251.9873">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="510.5" y="251.9873">Please select login method</text><path d="M10,271.8438 L147,271.8438 L147,280.1953 L137,290.1953 L10,290.1953 L10,271.8438 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="2036.6406" style="stroke:#000000;stroke-width:1.5;" width="1213.5" x="10" y="271.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="92" x="25" y="286.3389">Authentication</text><polygon fill="#181818" points="1140.5,308.5469,1150.5,312.5469,1140.5,316.5469,1144.5,312.5469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="477.5" x2="1146.5" y1="312.5469" y2="312.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="484.5" y="307.6904">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="495.5" y="307.6904">Select "Login with VC"</text><path d="M482,325.5469 L482,416.5469 L847,416.5469 L847,335.5469 L837,325.5469 L482,325.5469 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M837,325.5469 L837,335.5469 L847,335.5469 L837,325.5469 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="329" x="488" y="344.042">When customer selects "Login with Verifiable Credential"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240" x="488" y="360.3936">the Packet Delivery Portal displays a QR.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259" x="488" y="376.7451">The QR includes a nonce called &lt;state&gt; that</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="304" x="488" y="393.0967">will be used by Packet Delivery system to match the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="488" y="409.4482">start with the end of the login process, seen here</text><a href="https://www.google.com" target="_top" title="https://www.google.com" xlink:actuate="onRequest" xlink:href="https://www.google.com" xlink:show="new" xlink:title="https://www.google.com" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="58" x="774" y="409.4482">Click here</text></a><polygon fill="#181818" points="493.5,440.6563,483.5,444.6563,493.5,448.6563,489.5,444.6563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="487.5" x2="1156.5" y1="444.6563" y2="444.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="499.5" y="439.7998">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264" x="510.5" y="439.7998">Display QR including endpoint URL + &lt;state&gt;</text><polygon fill="#181818" points="264.5,471.0078,254.5,475.0078,264.5,479.0078,260.5,475.0078" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="258.5" x2="476.5" y1="475.0078" y2="475.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="270.5" y="470.1514">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="281.5" y="470.1514">Scan QR</text><path d="M36,488.0078 L36,530.0078 L461,530.0078 L461,498.0078 L451,488.0078 L36,488.0078 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M451,488.0078 L451,498.0078 L461,498.0078 L451,488.0078 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="404" x="42" y="506.5029">The customer uses its wallet to scan the QR in Packet Delivery Portal</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="341" x="42" y="522.8545">The wallet uses the URL inside the QR to start the process</text><polygon fill="#181818" points="829.5,570.4141,839.5,574.4141,829.5,578.4141,833.5,574.4141" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="253.5" x2="835.5" y1="574.4141" y2="574.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="260.5" y="561.3818">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="271.5" y="553.2061">POST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="271.5" y="569.5576">/authentication-requests</text><path d="M711,587.4141 L711,613.4141 L981,613.4141 L981,597.4141 L971,587.4141 L711,587.4141 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M971,587.4141 L971,597.4141 L981,597.4141 L971,587.4141 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="717" y="605.9092">The SIOP authentication process is started</text><line style="stroke:#181818;stroke-width:1.0;" x1="851.5" x2="893.5" y1="657.4688" y2="657.4688"/><line style="stroke:#181818;stroke-width:1.0;" x1="893.5" x2="893.5" y1="657.4688" y2="670.4688"/><line style="stroke:#181818;stroke-width:1.0;" x1="852.5" x2="893.5" y1="670.4688" y2="670.4688"/><polygon fill="#181818" points="862.5,666.4688,852.5,670.4688,862.5,674.4688,858.5,670.4688" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="858.5" y="644.4365">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="869.5" y="636.2607">Create</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="869.5" y="652.6123">Authenticaton Request</text><polygon fill="#181818" points="264.5,696.8203,254.5,700.8203,264.5,704.8203,260.5,700.8203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="258.5" x2="845.5" y1="700.8203" y2="700.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="270.5" y="695.9639">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="281.5" y="695.9639">URI + &lt;Request Token&gt;</text><path d="M258,713.8203 L258,755.8203 L718,755.8203 L718,723.8203 L708,713.8203 L258,713.8203 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M708,713.8203 L708,723.8203 L718,723.8203 L708,713.8203 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="439" x="264" y="732.3154">The Request Token contains the DID of Packet Delivery, among other things</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266" x="264" y="748.667">The URI is the standard SIOP URI for callback</text><polygon fill="#181818" points="68,812.5781,58,816.5781,68,820.5781,64,816.5781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="62" x2="242.5" y1="816.5781" y2="816.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="74" y="795.3701">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="92" y="779.0186">Resolve DID of</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="92" y="795.3701">Packet Delivery in</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="146" x="92" y="811.7217">Trusted Participant List</text><path d="M62,829.5781 L62,1035.5781 L798,1035.5781 L798,839.5781 L788,829.5781 L62,829.5781 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M788,829.5781 L788,839.5781 L798,839.5781 L788,829.5781 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="518" x="68" y="848.0732">This is a Universal Resolver server, that receives a DID and resolves it to a DID Document.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="547" x="68" y="864.4248">The DID Document (as per W3C) contains relevant information about the entity owning the DID,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="68" y="880.7764">containing:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="361" x="68" y="897.1279">- The Public Key of the entity used to verify its digital signature</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="292" x="68" y="913.4795">- Status of the entity in the Trusted Participant List</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="68" y="929.8311"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="649" x="68" y="946.1826">The DID Document is extensible, and can contain any public information which may be relevant for the use case.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="618" x="68" y="962.5342">The Universal Resolver server has to be operated by a trusted entity for the customer and for minimizing the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="588" x="68" y="978.8857">required trust in the ecosystem there may be as many nodes as needed operated by different entities.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="473" x="68" y="995.2373">At least one of those trusted entities has to be configured in the wallet of the user.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="715" x="68" y="1011.5889">FIWARE uses a Universal Resolver accessing a blockchain network where the Trusted Lists are managed, but Trusted Lists</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="400" x="68" y="1027.9404">can be implemented with any technology suitable for the ecosysmen.</text><polygon fill="#181818" points="231.5,1075.5,241.5,1079.5,231.5,1083.5,235.5,1079.5" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52" x2="237.5" y1="1079.5" y2="1079.5"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="59" y="1066.4678">11</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="90" x="77" y="1058.292">DID Document</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="171" y="1058.292">of</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="77" y="1074.6436">Packet Delivery Co</text><line style="stroke:#181818;stroke-width:1.0;" x1="253.5" x2="295.5" y1="1109.8516" y2="1109.8516"/><line style="stroke:#181818;stroke-width:1.0;" x1="295.5" x2="295.5" y1="1109.8516" y2="1122.8516"/><line style="stroke:#181818;stroke-width:1.0;" x1="254.5" x2="295.5" y1="1122.8516" y2="1122.8516"/><polygon fill="#181818" points="264.5,1118.8516,254.5,1122.8516,264.5,1126.8516,260.5,1122.8516" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="260.5" y="1104.9951">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="278.5" y="1104.9951">Verify Authentication Request</text><path d="M258,1135.8516 L258,1275.8516 L850,1275.8516 L850,1145.8516 L840,1135.8516 L258,1135.8516 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M840,1135.8516 L840,1145.8516 L850,1145.8516 L840,1135.8516 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="264" y="1154.3467">The wallet checks:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="296" x="264" y="1170.6982">- the digital signature of the Authentication Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="571" x="264" y="1187.0498">- that the DID inside the request matches the DID inside the DID Document from Universal Resolver</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="544" x="264" y="1203.4014">- any additional info inside the request against the DID Document, as required by the use case</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="264" y="1219.7529"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="290" x="264" y="1236.1045">Now the wallet knows that Packet Delivery Co is a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="538" x="264" y="1252.4561">trusted participant entity and that it signed the request and the request has not been modified</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="264" y="1268.8076">since it was signed.</text><line style="stroke:#181818;stroke-width:1.0;" x1="253.5" x2="295.5" y1="1320.3672" y2="1320.3672"/><line style="stroke:#181818;stroke-width:1.0;" x1="295.5" x2="295.5" y1="1320.3672" y2="1333.3672"/><line style="stroke:#181818;stroke-width:1.0;" x1="254.5" x2="295.5" y1="1333.3672" y2="1333.3672"/><polygon fill="#181818" points="264.5,1329.3672,254.5,1333.3672,264.5,1337.3672,260.5,1333.3672" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="260.5" y="1307.335">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="278.5" y="1299.1592">Create Authentication Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="278.5" y="1315.5107">with &lt;vp_token&gt;</text><path d="M258,1346.3672 L258,1421.3672 L611,1421.3672 L611,1356.3672 L601,1346.3672 L258,1346.3672 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M601,1346.3672 L601,1356.3672 L611,1356.3672 L601,1346.3672 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="300" x="264" y="1364.8623">The wallet creates a SIOP Authentication Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="327" x="264" y="1381.2139">The vp_token includes one or more Verifiable Credentials</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="332" x="264" y="1397.5654">In this case there is only one Verifiable Credential, issued</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="264" y="1413.917">by Happy Pets to its customer</text><polygon fill="#181818" points="829.5,1445.125,839.5,1449.125,829.5,1453.125,833.5,1449.125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="248.5" x2="835.5" y1="1449.125" y2="1449.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="255.5" y="1444.2686">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="288" x="273.5" y="1444.2686">POST &lt;Authentication Response&gt; /siop-sessions</text><path d="M253,1462.125 L253,1504.125 L597,1504.125 L597,1472.125 L587,1462.125 L253,1462.125 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M587,1462.125 L587,1472.125 L597,1472.125 L587,1462.125 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="323" x="259" y="1480.6201">The URI to which the POST is done was specified in the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="316" x="259" y="1496.9717">Authentication Request that was received by the wallet</text><polygon fill="#181818" points="1022.5,1560.8828,1032.5,1564.8828,1022.5,1568.8828,1026.5,1564.8828" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="851.5" x2="1028.5" y1="1564.8828" y2="1564.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="858.5" y="1543.6748">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="876.5" y="1527.3232">Resolve DID of</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="876.5" y="1543.6748">Happy Pets in</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="146" x="876.5" y="1560.0264">Trusted Participant List</text><path d="M423,1577.8828 L423,1685.8828 L1029,1685.8828 L1029,1587.8828 L1019,1577.8828 L423,1577.8828 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1019,1577.8828 L1019,1587.8828 L1029,1587.8828 L1019,1577.8828 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="544" x="429" y="1596.3779">This can be a Universal Resolver operated by Packet Delivery Co or by any entity trusted by it.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="395" x="429" y="1612.7295">For maximum level of trust, the node is operated by Packet Delivery.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="455" x="429" y="1629.0811">The Verifiable Credential received from the user was signed by Happy Pets and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="429" y="1645.4326">includes the DID of Happy Pets.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="585" x="429" y="1661.7842">Packet Delivery retrieves the DID Document for that DID to check that it is a trusted participant entity.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="509" x="429" y="1678.1357">In addition it checks the digital signature using the Public Key inside the DID Document.</text><polygon fill="#181818" points="862.5,1725.6953,852.5,1729.6953,862.5,1733.6953,858.5,1729.6953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="856.5" x2="1038.5" y1="1729.6953" y2="1729.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="868.5" y="1716.6631">16</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="90" x="886.5" y="1708.4873">DID Document</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="886.5" y="1724.8389">with public key</text><line style="stroke:#181818;stroke-width:1.0;" x1="851.5" x2="893.5" y1="1776.3984" y2="1776.3984"/><line style="stroke:#181818;stroke-width:1.0;" x1="893.5" x2="893.5" y1="1776.3984" y2="1789.3984"/><line style="stroke:#181818;stroke-width:1.0;" x1="852.5" x2="893.5" y1="1789.3984" y2="1789.3984"/><polygon fill="#181818" points="862.5,1785.3984,852.5,1789.3984,862.5,1793.3984,858.5,1789.3984" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="858.5" y="1763.3662">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="876.5" y="1755.1904">Verify</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="876.5" y="1771.542">Authentication Response</text><path d="M523,1802.3984 L523,1893.3984 L1170,1893.3984 L1170,1812.3984 L1160,1802.3984 L523,1802.3984 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1160,1802.3984 L1160,1812.3984 L1170,1812.3984 L1160,1802.3984 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="573" x="529" y="1820.8936">The VC issued by Happy Pets to the customer includes the Public Key associated to the customer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324" x="529" y="1837.2451">and that was used to sign the Authentication Response.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="551" x="529" y="1853.5967">The Public Key of the customer was verified when the customer was onboarded by Happy Pets.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="626" x="529" y="1869.9482">For maximum privacy, SIOP (customer) can have a different key for each company where she is a customer.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="500" x="529" y="1886.2998">In each onboarding process the SIOP can generate a different key pair (pairwise DIDs).</text><polygon fill="#181818" points="259.5,1917.5078,249.5,1921.5078,259.5,1925.5078,255.5,1921.5078" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="253.5" x2="840.5" y1="1921.5078" y2="1921.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="265.5" y="1916.6514">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="283.5" y="1916.6514">HTTP 200</text><path d="M253,1934.5078 L253,2009.5078 L685,2009.5078 L685,1944.5078 L675,1934.5078 L253,1934.5078 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M675,1934.5078 L675,1944.5078 L685,1944.5078 L675,1934.5078 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="345" x="259" y="1953.0029">The wallet receives the response to the POST indicating the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="259" y="1969.3545">success or failure of the process.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="411" x="259" y="1985.7061">The web portal will refresh its content based on the information received</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="259" y="2002.0576">by the Packet Delivery system.</text><line style="stroke:#181818;stroke-width:1.0;" x1="851.5" x2="893.5" y1="2037.2656" y2="2037.2656"/><line style="stroke:#181818;stroke-width:1.0;" x1="893.5" x2="893.5" y1="2037.2656" y2="2050.2656"/><line style="stroke:#181818;stroke-width:1.0;" x1="852.5" x2="893.5" y1="2050.2656" y2="2050.2656"/><polygon fill="#181818" points="862.5,2046.2656,852.5,2050.2656,862.5,2054.2656,858.5,2050.2656" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="858.5" y="2032.4092">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="876.5" y="2032.4092">Generate Access Token</text><path d="M557,2063.2656 L557,2105.2656 L1136,2105.2656 L1136,2073.2656 L1126,2063.2656 L557,2063.2656 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1126,2063.2656 L1126,2073.2656 L1136,2073.2656 L1126,2063.2656 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="558" x="563" y="2081.7607">The RP component generates an Access Token in JWT format signed by the RP component and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="485" x="563" y="2098.1123">including the information of the Verifiable Credential needed to perform authorization.</text><polygon fill="#181818" points="1140.5,2145.6719,1150.5,2149.6719,1140.5,2153.6719,1144.5,2149.6719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="846.5" x2="1146.5" y1="2149.6719" y2="2149.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="853.5" y="2136.6396">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="871.5" y="2128.4639">Notify with Verifiable Credential and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45" x="871.5" y="2144.8154">&lt;state&gt;</text><path d="M578,2162.6719 L578,2302.6719 L1115,2302.6719 L1115,2172.6719 L1105,2162.6719 L578,2162.6719 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1105,2162.6719 L1105,2172.6719 L1115,2172.6719 L1105,2162.6719 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="485" x="584" y="2181.167">The RP component of Packet Delivery notifies the Portal to refresh the login page so</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="584" y="2197.5186">it can present the services to the customer.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="584" y="2213.8701">The notification includes the following:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="516" x="584" y="2230.2217">- the &lt;state&gt; nonce that was generated by the portal when it generated the QR code. The</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="397" x="584" y="2246.5732">portal uses the &lt;state&gt; nonce to know what login session is notified.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="584" y="2262.9248">- The &lt;Access Token&gt; generated before</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="584" y="2279.2764"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="319" x="584" y="2295.6279">The notification URL is configured in the RP component</text><path d="M546,2320.4844 L546,2411.4844 L1146,2411.4844 L1146,2330.4844 L1136,2320.4844 L546,2320.4844 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1136,2320.4844 L1136,2330.4844 L1146,2330.4844 L1136,2320.4844 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="504" x="552" y="2338.9795">The authentication process has been finished and we still have to perform authorisation.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="571" x="552" y="2355.3311">Instead of presenting all possible services and authorize or deny based on the role of the customer,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="579" x="552" y="2371.6826">in this example we present to the customer only the services that the customer is authorized to use.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="539" x="552" y="2388.0342">The information required is inside the &lt;Access Token&gt; and includes the roles assigned to the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="288" x="552" y="2404.3857">customer when Happy Pets issued the credential.</text><path d="M430,2424.2422 L559,2424.2422 L559,2432.5938 L549,2442.5938 L430,2442.5938 L430,2424.2422 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="1256.6328" style="stroke:#000000;stroke-width:1.5;" width="1499.5" x="430" y="2424.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="84" x="445" y="2438.7373">Authorisation</text><polygon fill="#181818" points="1555.5,2493.6484,1565.5,2497.6484,1555.5,2501.6484,1559.5,2497.6484" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1157.5" x2="1561.5" y1="2497.6484" y2="2497.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1164.5" y="2476.4404">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="1182.5" y="2460.0889">Verify authorisation of Happy Pets</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="1182.5" y="2476.4404">to issue the credential.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="1182.5" y="2492.792">Send &lt;Access Token&gt;</text><path d="M1176,2510.6484 L1176,2536.6484 L1562,2536.6484 L1562,2520.6484 L1552,2510.6484 L1176,2510.6484 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1552,2510.6484 L1552,2520.6484 L1562,2520.6484 L1552,2510.6484 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="365" x="1182" y="2529.1436">Use the information inside &lt;Access Token&gt; to check in the AR</text><line style="stroke:#181818;stroke-width:1.0;" x1="1577.5" x2="1619.5" y1="2564.3516" y2="2564.3516"/><line style="stroke:#181818;stroke-width:1.0;" x1="1619.5" x2="1619.5" y1="2564.3516" y2="2577.3516"/><line style="stroke:#181818;stroke-width:1.0;" x1="1578.5" x2="1619.5" y1="2577.3516" y2="2577.3516"/><polygon fill="#181818" points="1588.5,2573.3516,1578.5,2577.3516,1588.5,2581.3516,1584.5,2577.3516" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1584.5" y="2559.4951">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="315" x="1602.5" y="2559.4951">Verify if Happy Pets bought the Gold or Normal service</text><path d="M983,2590.3516 L983,2698.3516 L1562,2698.3516 L1562,2600.3516 L1552,2590.3516 L983,2590.3516 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1552,2590.3516 L1552,2600.3516 L1562,2600.3516 L1552,2590.3516 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="414" x="989" y="2608.8467">At this moment we know that the credential was issued by Happy Pets,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="401" x="989" y="2625.1982">but we have to check if it is entitled to issue that type of credential, or</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="989" y="2641.5498">if the credential is stil valid at this moment.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="463" x="989" y="2657.9014">We check in the Authorization Registry if Happy Pets is paying for a service and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="558" x="989" y="2674.2529">also wether it is the Gold or Normal service, because only in this case its customers can access</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="989" y="2690.6045">the Gold services from Packet Delivery.</text><polygon fill="#181818" points="1173.5,2721.8125,1163.5,2725.8125,1173.5,2729.8125,1169.5,2725.8125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1167.5" x2="1571.5" y1="2725.8125" y2="2725.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1179.5" y="2720.9561">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="1197.5" y="2720.9561">Send authorization data</text><path d="M930,2738.8125 L930,2797.8125 L1384,2797.8125 L1384,2748.8125 L1374,2738.8125 L930,2738.8125 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1374,2738.8125 L1374,2748.8125 L1384,2748.8125 L1374,2738.8125 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="433" x="936" y="2757.3076">Reply can be Unauthorized, Normal or Gold, if Happy Pets is not paying for</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="408" x="936" y="2773.6592">any service, for the Normal service or for the Gold service, respectively.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="936" y="2790.0107">We assume here that the reply is Gold.</text><line style="stroke:#181818;stroke-width:1.0;" x1="1162.5" x2="1204.5" y1="2857.9219" y2="2857.9219"/><line style="stroke:#181818;stroke-width:1.0;" x1="1204.5" x2="1204.5" y1="2857.9219" y2="2870.9219"/><line style="stroke:#181818;stroke-width:1.0;" x1="1163.5" x2="1204.5" y1="2870.9219" y2="2870.9219"/><polygon fill="#181818" points="1173.5,2866.9219,1163.5,2870.9219,1173.5,2874.9219,1169.5,2870.9219" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1169.5" y="2836.7139">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="1187.5" y="2820.3623">Calculate the services that this</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="1187.5" y="2836.7139">customer can access.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="1187.5" y="2853.0654">In this case, Gold services.</text><polygon fill="#181818" points="493.5,2913.625,483.5,2917.625,493.5,2921.625,489.5,2917.625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="487.5" x2="1156.5" y1="2917.625" y2="2917.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="499.5" y="2904.5928">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="301" x="517.5" y="2896.417">Refresh the screen with services for Gold customers</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="517.5" y="2912.7686">and include &lt;Access Token&gt;</text><path d="M487,2930.625 L487,3038.625 L943,3038.625 L943,2940.625 L933,2930.625 L487,2930.625 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M933,2930.625 L933,2940.625 L943,2940.625 L933,2930.625 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="493" y="2949.1201">At this point, Packet Delivery knows:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="281" x="509" y="2965.4717">1. That Happy Pets is a trusted participant entity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="419" x="509" y="2981.8232">2. That Happy Pets can issue credentials of type Gold (and also Normal)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="302" x="509" y="2998.1748">3. That happy Pets says that the user is a customer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="509" y="3014.5264">4. The category of customer (Normal/Gold)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="313" x="509" y="3030.8779">5. Any user info encoded into the VC, like customer id</text><polygon fill="#181818" points="688.5,3094.7891,698.5,3098.7891,688.5,3102.7891,692.5,3098.7891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="477.5" x2="694.5" y1="3098.7891" y2="3098.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="484.5" y="3077.5811">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="502.5" y="3061.2295">Customer selects</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="502.5" y="3077.5811">"Change PTA" on delivery order</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="502.5" y="3093.9326">Send &lt;Access Token&gt;</text><path d="M452,3111.7891 L452,3153.7891 L959,3153.7891 L959,3121.7891 L949,3111.7891 L452,3111.7891 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M949,3111.7891 L949,3121.7891 L959,3121.7891 L949,3111.7891 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="344" x="458" y="3130.2842">The Policy Enforcement Point (PEP) intercepts request and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="486" x="458" y="3146.6357">checks that the request includes an &lt;Access Token&gt; signed by Packet Delivery RP</text><line style="stroke:#181818;stroke-width:1.0;" x1="710.5" x2="752.5" y1="3198.1953" y2="3198.1953"/><line style="stroke:#181818;stroke-width:1.0;" x1="752.5" x2="752.5" y1="3198.1953" y2="3211.1953"/><line style="stroke:#181818;stroke-width:1.0;" x1="711.5" x2="752.5" y1="3211.1953" y2="3211.1953"/><polygon fill="#181818" points="721.5,3207.1953,711.5,3211.1953,721.5,3215.1953,717.5,3211.1953" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="717.5" y="3185.1631">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="735.5" y="3176.9873">Validate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="735.5" y="3193.3389">&lt;Access Token&gt;</text><path d="M496,3224.1953 L496,3283.1953 L915,3283.1953 L915,3234.1953 L905,3224.1953 L496,3224.1953 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M905,3224.1953 L905,3234.1953 L915,3234.1953 L905,3224.1953 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="398" x="502" y="3242.6904">The Policy Enforcement Point (PEP) intercepts request and asks the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="364" x="502" y="3259.042">Policy Decision Point (PDP) to evaluate if the &lt;Access Token&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="354" x="502" y="3275.3936">authorizes caller to access the target service ("Change PTA")</text><polygon fill="#181818" points="1360.5,3322.9531,1370.5,3326.9531,1360.5,3330.9531,1364.5,3326.9531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="705.5" x2="1366.5" y1="3326.9531" y2="3326.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="712.5" y="3313.9209">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="730.5" y="3305.7451">Evaluate authorisation request for "Change PTA"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="730.5" y="3322.0967">with &lt;Access Token&gt;</text><path d="M1165,3339.9531 L1165,3381.9531 L1589,3381.9531 L1589,3349.9531 L1579,3339.9531 L1165,3339.9531 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1579,3339.9531 L1579,3349.9531 L1589,3349.9531 L1579,3339.9531 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="403" x="1171" y="3358.4482">Use information in &lt;Access Token&gt; to evaluate policies associated to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="1171" y="3374.7998">customer roles in the token.</text><polygon fill="#181818" points="1555.5,3438.7109,1565.5,3442.7109,1555.5,3446.7109,1559.5,3442.7109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1377.5" x2="1561.5" y1="3442.7109" y2="3442.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1384.5" y="3421.5029">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="1402.5" y="3405.1514">Evaluate authorisation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="1402.5" y="3421.5029">of user evaluating policies</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="1402.5" y="3437.8545">associated to roles</text><polygon fill="#181818" points="1393.5,3469.0625,1383.5,3473.0625,1393.5,3477.0625,1389.5,3473.0625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1387.5" x2="1571.5" y1="3473.0625" y2="3473.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1399.5" y="3468.2061">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="1417.5" y="3468.2061">User is authorised</text><polygon fill="#181818" points="721.5,3499.4141,711.5,3503.4141,721.5,3507.4141,717.5,3503.4141" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="715.5" x2="1376.5" y1="3503.4141" y2="3503.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="727.5" y="3498.5576">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="745.5" y="3498.5576">Authorisation granted</text><polygon fill="#181818" points="1140.5,3562.4688,1150.5,3566.4688,1140.5,3570.4688,1144.5,3566.4688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="705.5" x2="1146.5" y1="3566.4688" y2="3566.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="712.5" y="3545.2607">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="730.5" y="3528.9092">Forward original request:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="730.5" y="3545.2607">Change PTA on delivery order</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="730.5" y="3561.6123">with &lt;Access Token&gt;</text><line style="stroke:#181818;stroke-width:1.0;" x1="1162.5" x2="1204.5" y1="3629.5234" y2="3629.5234"/><line style="stroke:#181818;stroke-width:1.0;" x1="1204.5" x2="1204.5" y1="3629.5234" y2="3642.5234"/><line style="stroke:#181818;stroke-width:1.0;" x1="1163.5" x2="1204.5" y1="3642.5234" y2="3642.5234"/><polygon fill="#181818" points="1173.5,3638.5234,1163.5,3642.5234,1173.5,3646.5234,1169.5,3642.5234" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1169.5" y="3608.3154">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="1187.5" y="3591.9639">Perform change</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="1187.5" y="3608.3154">Request forwarded to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="1187.5" y="3624.667">Context Broker (not shown)</text><polygon fill="#181818" points="488.5,3668.875,478.5,3672.875,488.5,3676.875,484.5,3672.875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="482.5" x2="1156.5" y1="3672.875" y2="3672.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="494.5" y="3668.0186">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="512.5" y="3668.0186">Change confirmed</text><!--MD5=[71fe49bfbf8d9b1b7a265085af15af6e]
@startuml vc_change_pta_new

title Packet Delivery - HappyPets customer changes PTA

autonumber 1
skinparam SequenceBoxBorderColor transparent

database "Universal\nResolver" as DIDR

box User #MistyRose
    actor "Prime Customer" as primeCustomer #f7a6a6
    participant "Customer\nSIOP" as customerSIOP #f7a6a6
    participant "Customer\nBrowser" as customerBrowser #f7a6a6
endbox

box PacketDelivery #ebfcef
    participant "Packet Delivery\nPEP" as packetDeliveryPEP #92e8c6
    participant "Packet Delivery\nRP" as packetDeliverySIOP #92e8c6
    database "Packet Delivery\nUniversal\nResolver" as DIDR_pack #92e8c6
    participant "Packet Delivery\nPortal" as packetDeliveryPortal #92e8c6
    participant "Packet Delivery\nPDP" as packetDeliveryPDP #92e8c6
    participant "Packet Delivery\nAuthorisation\nRegistry" as packetDeliveryAR #92e8c6
endbox

'Visit the Packet Delivery Portal and select logon method
primeCustomer- ->customerBrowser ++: Access portal
customerBrowser->packetDeliveryPortal - -++: Accesses portal
packetDeliveryPortal->customerBrowser - -++: Please select login method

group Authentication

    'A QR code is displayed and scanned by the customer to start the login process.
    'The QR code includes the URL of th eendpoint that will start the process when invoked by the SIOP
    customerBrowser->packetDeliveryPortal - -++: Select "Login with VC"
    note right customerBrowser
        When customer selects "Login with Verifiable Credential"
        the Packet Delivery Portal displays a QR.
        The QR includes a nonce called <state> that
        will be used by Packet Delivery system to match the
        start with the end of the login process, seen here [[https://www.google.com Click here]]
    end note
    packetDeliveryPortal->customerBrowser - -++: Display QR including endpoint URL + <state>
    customerBrowser- ->customerSIOP - -++: Scan QR

    'Perform a POST to start the process
    note over customerSIOP
        The customer uses its wallet to scan the QR in Packet Delivery Portal
        The wallet uses the URL inside the QR to start the process
    end note
    customerSIOP -> packetDeliverySIOP ++:POST \n/authentication-requests

    note over packetDeliverySIOP: The SIOP authentication process is started
    packetDeliverySIOP -> packetDeliverySIOP :Create\nAuthenticaton Request
    return URI + <Request Token>
    note right customerSIOP
        The Request Token contains the DID of Packet Delivery, among other things
        The URI is the standard SIOP URI for callback
    end note

    'Resolve the DID of Packet Delivery
    customerSIOP -> DIDR ++: Resolve DID of\nPacket Delivery in\n**Trusted Participant List**
    note right DIDR
        This is a Universal Resolver server, that receives a DID and resolves it to a DID Document.
        The DID Document (as per W3C) contains relevant information about the entity owning the DID,
        containing:
        - The Public Key of the entity used to verify its digital signature
        - Status of the entity in the Trusted Participant List

        The DID Document is extensible, and can contain any public information which may be relevant for the use case.
        The Universal Resolver server has to be operated by a trusted entity for the customer and for minimizing the
        required trust in the ecosystem there may be as many nodes as needed operated by different entities.
        At least one of those trusted entities has to be configured in the wallet of the user.
        FIWARE uses a Universal Resolver accessing a blockchain network where the Trusted Lists are managed, but Trusted Lists
        can be implemented with any technology suitable for the ecosysmen.
    end note 
    return **DID Document** of\nPacket Delivery Co

    'Verify the Authentication Request using the DID Document
    customerSIOP -> customerSIOP: Verify Authentication Request
    note right customerSIOP
        The wallet checks:
        - the digital signature of the Authentication Request
        - that the DID inside the request matches the DID inside the DID Document from Universal Resolver
        - any additional info inside the request against the DID Document, as required by the use case

        Now the wallet knows that Packet Delivery Co is a
        trusted participant entity and that it signed the request and the request has not been modified
        since it was signed.
    end note
    customerSIOP -> customerSIOP: Create Authentication Response\nwith <vp_token>

    note right customerSIOP
        The wallet creates a SIOP Authentication Response
        The vp_token includes one or more Verifiable Credentials
        In this case there is only one Verifiable Credential, issued
        by Happy Pets to its customer
    end note
    'Perform a POST to send the Authentication Response
    customerSIOP -> packetDeliverySIOP - -++: POST <Authentication Response> /siop-sessions

    note right customerSIOP
        The URI to which the POST is done was specified in the
        Authentication Request that was received by the wallet
    end note

    'Resolve DID of HappyPets to see if it is trusted issuer
    packetDeliverySIOP->DIDR_pack ++: Resolve DID of\nHappy Pets in\n**Trusted Participant List**
    note left DIDR_pack
        This can be a Universal Resolver operated by Packet Delivery Co or by any entity trusted by it.
        For maximum level of trust, the node is operated by Packet Delivery.
        The Verifiable Credential received from the user was signed by Happy Pets and
        includes the DID of Happy Pets.
        Packet Delivery retrieves the DID Document for that DID to check that it is a trusted participant entity.
        In addition it checks the digital signature using the Public Key inside the DID Document.
    end note
    return **DID Document**\nwith public key

    'Verify the Authentication Response from the mobile wallet
    packetDeliverySIOP->packetDeliverySIOP: Verify\nAuthentication Response
    note over packetDeliverySIOP
        The VC issued by Happy Pets to the customer includes the Public Key associated to the customer
        and that was used to sign the Authentication Response.
        The Public Key of the customer was verified when the customer was onboarded by Happy Pets.
        For maximum privacy, SIOP (customer) can have a different key for each company where she is a customer.
        In each onboarding process the SIOP can generate a different key pair (pairwise DIDs).
    end note
    packetDeliverySIOP->customerSIOP : HTTP 200
    deactivate customerSIOP
    note right customerSIOP
        The wallet receives the response to the POST indicating the
        success or failure of the process.
        The web portal will refresh its content based on the information received
        by the Packet Delivery system.
    end note

    'Generate an Access Token including the information in the Verifiable Credential
    packetDeliverySIOP->packetDeliverySIOP : Generate Access Token
    note over packetDeliverySIOP
        The RP component generates an Access Token in JWT format signed by the RP component and
        including the information of the Verifiable Credential needed to perform authorization.
    end note

    'Notify the portal so it refreshes the login page with services available to the customer
    packetDeliverySIOP- ->packetDeliveryPortal - -++: Notify with Verifiable Credential and\n<state>
    note over packetDeliverySIOP
        The RP component of Packet Delivery notifies the Portal to refresh the login page so
        it can present the services to the customer.
        The notification includes the following:
        - the <state> nonce that was generated by the portal when it generated the QR code. The
        portal uses the <state> nonce to know what login session is notified.
        - The <Access Token> generated before

        The notification URL is configured in the RP component
    end note

end group

note over packetDeliverySIOP
    The authentication process has been finished and we still have to perform authorisation.
    Instead of presenting all possible services and authorize or deny based on the role of the customer,
    in this example we present to the customer only the services that the customer is authorized to use.
    The information required is inside the <Access Token> and includes the roles assigned to the
    customer when Happy Pets issued the credential.
end note


group Authorisation

    'Verify that Happy Pets is paying for the proper service
    packetDeliveryPortal->packetDeliveryAR - -++: Verify authorisation of Happy Pets\nto issue the credential.\nSend <Access Token>
    note left packetDeliveryAR
        Use the information inside <Access Token> to check in the AR
    end note

    packetDeliveryAR->packetDeliveryAR: Verify if Happy Pets bought the Gold or Normal service
    note left packetDeliveryAR
        At this moment we know that the credential was issued by Happy Pets,
        but we have to check if it is entitled to issue that type of credential, or
        if the credential is stil valid at this moment.
        We check in the Authorization Registry if Happy Pets is paying for a service and
        also wether it is the Gold or Normal service, because only in this case its customers can access
        the Gold services from Packet Delivery.
    end note

    'We assume that Happy Pets is paying for the Gold service
    packetDeliveryAR->packetDeliveryPortal - -++: Send authorization data
    note over packetDeliveryPortal
        Reply can be Unauthorized, Normal or Gold, if Happy Pets is not paying for
        any service, for the Normal service or for the Gold service, respectively.
        We assume here that the reply is Gold.
    end note

    packetDeliveryPortal->packetDeliveryPortal: Calculate the services that this\ncustomer can access.\nIn this case, Gold services.
    packetDeliveryPortal- ->customerBrowser - -++: Refresh the screen with services for Gold customers\nand include <Access Token>

    note right customerBrowser
        At this point, Packet Delivery knows:
            1. That Happy Pets is a trusted participant entity
            2. That Happy Pets can issue credentials of type Gold (and also Normal)
            3. That happy Pets says that the user is a customer
            4. The category of customer (Normal/Gold)
            5. Any user info encoded into the VC, like customer id
    end note

    'The customer selects to change the PTA
    customerBrowser->packetDeliveryPEP - -++: Customer selects\n"Change PTA" on delivery order\nSend <Access Token>
    note over packetDeliveryPEP
        The Policy Enforcement Point (PEP) intercepts request and
        checks that the request includes an <Access Token> signed by Packet Delivery RP
    end note
    packetDeliveryPEP->packetDeliveryPEP: Validate\n<Access Token>
    note over packetDeliveryPEP
        The Policy Enforcement Point (PEP) intercepts request and asks the
        Policy Decision Point (PDP) to evaluate if the <Access Token>
        authorizes caller to access the target service ("Change PTA")
    end note

    packetDeliveryPEP->packetDeliveryPDP - -++: Evaluate authorisation request for "Change PTA"\nwith <Access Token>

    note over packetDeliveryPDP
        Use information in <Access Token> to evaluate policies associated to
        customer roles in the token.
    end note
    'Check policies for this customer
    packetDeliveryPDP->packetDeliveryAR - -++: Evaluate authorisation\nof user evaluating policies\nassociated to roles
    packetDeliveryAR->packetDeliveryPDP - -++: User is authorised


    packetDeliveryPDP->packetDeliveryPEP - -++:Authorisation granted
    packetDeliveryPEP->packetDeliveryPortal - -++:Forward original request:\nChange PTA on delivery order\nwith <Access Token>

    packetDeliveryPortal->packetDeliveryPortal: Perform change\nRequest forwarded to\nContext Broker (not shown)
    packetDeliveryPortal->customerBrowser - -:Change confirmed

end group

@enduml

@startuml vc_change_pta_new

title Packet Delivery - HappyPets customer changes PTA

autonumber 1
skinparam SequenceBoxBorderColor transparent

database "Universal\nResolver" as DIDR

box User #MistyRose
    actor "Prime Customer" as primeCustomer #f7a6a6
    participant "Customer\nSIOP" as customerSIOP #f7a6a6
    participant "Customer\nBrowser" as customerBrowser #f7a6a6
endbox

box PacketDelivery #ebfcef
    participant "Packet Delivery\nPEP" as packetDeliveryPEP #92e8c6
    participant "Packet Delivery\nRP" as packetDeliverySIOP #92e8c6
    database "Packet Delivery\nUniversal\nResolver" as DIDR_pack #92e8c6
    participant "Packet Delivery\nPortal" as packetDeliveryPortal #92e8c6
    participant "Packet Delivery\nPDP" as packetDeliveryPDP #92e8c6
    participant "Packet Delivery\nAuthorisation\nRegistry" as packetDeliveryAR #92e8c6
endbox

primeCustomer- ->customerBrowser ++: Access portal
customerBrowser->packetDeliveryPortal - -++: Accesses portal
packetDeliveryPortal->customerBrowser - -++: Please select login method

group Authentication

    customerBrowser->packetDeliveryPortal - -++: Select "Login with VC"
    note right customerBrowser
        When customer selects "Login with Verifiable Credential"
        the Packet Delivery Portal displays a QR.
        The QR includes a nonce called <state> that
        will be used by Packet Delivery system to match the
        start with the end of the login process, seen here [[https://www.google.com Click here]]
    end note
    packetDeliveryPortal->customerBrowser - -++: Display QR including endpoint URL + <state>
    customerBrowser- ->customerSIOP - -++: Scan QR

    note over customerSIOP
        The customer uses its wallet to scan the QR in Packet Delivery Portal
        The wallet uses the URL inside the QR to start the process
    end note
    customerSIOP -> packetDeliverySIOP ++:POST \n/authentication-requests

    note over packetDeliverySIOP: The SIOP authentication process is started
    packetDeliverySIOP -> packetDeliverySIOP :Create\nAuthenticaton Request
    return URI + <Request Token>
    note right customerSIOP
        The Request Token contains the DID of Packet Delivery, among other things
        The URI is the standard SIOP URI for callback
    end note

    customerSIOP -> DIDR ++: Resolve DID of\nPacket Delivery in\n**Trusted Participant List**
    note right DIDR
        This is a Universal Resolver server, that receives a DID and resolves it to a DID Document.
        The DID Document (as per W3C) contains relevant information about the entity owning the DID,
        containing:
        - The Public Key of the entity used to verify its digital signature
        - Status of the entity in the Trusted Participant List

        The DID Document is extensible, and can contain any public information which may be relevant for the use case.
        The Universal Resolver server has to be operated by a trusted entity for the customer and for minimizing the
        required trust in the ecosystem there may be as many nodes as needed operated by different entities.
        At least one of those trusted entities has to be configured in the wallet of the user.
        FIWARE uses a Universal Resolver accessing a blockchain network where the Trusted Lists are managed, but Trusted Lists
        can be implemented with any technology suitable for the ecosysmen.
    end note 
    return **DID Document** of\nPacket Delivery Co

    customerSIOP -> customerSIOP: Verify Authentication Request
    note right customerSIOP
        The wallet checks:
        - the digital signature of the Authentication Request
        - that the DID inside the request matches the DID inside the DID Document from Universal Resolver
        - any additional info inside the request against the DID Document, as required by the use case

        Now the wallet knows that Packet Delivery Co is a
        trusted participant entity and that it signed the request and the request has not been modified
        since it was signed.
    end note
    customerSIOP -> customerSIOP: Create Authentication Response\nwith <vp_token>

    note right customerSIOP
        The wallet creates a SIOP Authentication Response
        The vp_token includes one or more Verifiable Credentials
        In this case there is only one Verifiable Credential, issued
        by Happy Pets to its customer
    end note
    customerSIOP -> packetDeliverySIOP - -++: POST <Authentication Response> /siop-sessions

    note right customerSIOP
        The URI to which the POST is done was specified in the
        Authentication Request that was received by the wallet
    end note

    packetDeliverySIOP->DIDR_pack ++: Resolve DID of\nHappy Pets in\n**Trusted Participant List**
    note left DIDR_pack
        This can be a Universal Resolver operated by Packet Delivery Co or by any entity trusted by it.
        For maximum level of trust, the node is operated by Packet Delivery.
        The Verifiable Credential received from the user was signed by Happy Pets and
        includes the DID of Happy Pets.
        Packet Delivery retrieves the DID Document for that DID to check that it is a trusted participant entity.
        In addition it checks the digital signature using the Public Key inside the DID Document.
    end note
    return **DID Document**\nwith public key

    packetDeliverySIOP->packetDeliverySIOP: Verify\nAuthentication Response
    note over packetDeliverySIOP
        The VC issued by Happy Pets to the customer includes the Public Key associated to the customer
        and that was used to sign the Authentication Response.
        The Public Key of the customer was verified when the customer was onboarded by Happy Pets.
        For maximum privacy, SIOP (customer) can have a different key for each company where she is a customer.
        In each onboarding process the SIOP can generate a different key pair (pairwise DIDs).
    end note
    packetDeliverySIOP->customerSIOP : HTTP 200
    deactivate customerSIOP
    note right customerSIOP
        The wallet receives the response to the POST indicating the
        success or failure of the process.
        The web portal will refresh its content based on the information received
        by the Packet Delivery system.
    end note

    packetDeliverySIOP->packetDeliverySIOP : Generate Access Token
    note over packetDeliverySIOP
        The RP component generates an Access Token in JWT format signed by the RP component and
        including the information of the Verifiable Credential needed to perform authorization.
    end note

    packetDeliverySIOP- ->packetDeliveryPortal - -++: Notify with Verifiable Credential and\n<state>
    note over packetDeliverySIOP
        The RP component of Packet Delivery notifies the Portal to refresh the login page so
        it can present the services to the customer.
        The notification includes the following:
        - the <state> nonce that was generated by the portal when it generated the QR code. The
        portal uses the <state> nonce to know what login session is notified.
        - The <Access Token> generated before

        The notification URL is configured in the RP component
    end note

end group

note over packetDeliverySIOP
    The authentication process has been finished and we still have to perform authorisation.
    Instead of presenting all possible services and authorize or deny based on the role of the customer,
    in this example we present to the customer only the services that the customer is authorized to use.
    The information required is inside the <Access Token> and includes the roles assigned to the
    customer when Happy Pets issued the credential.
end note


group Authorisation

    packetDeliveryPortal->packetDeliveryAR - -++: Verify authorisation of Happy Pets\nto issue the credential.\nSend <Access Token>
    note left packetDeliveryAR
        Use the information inside <Access Token> to check in the AR
    end note

    packetDeliveryAR->packetDeliveryAR: Verify if Happy Pets bought the Gold or Normal service
    note left packetDeliveryAR
        At this moment we know that the credential was issued by Happy Pets,
        but we have to check if it is entitled to issue that type of credential, or
        if the credential is stil valid at this moment.
        We check in the Authorization Registry if Happy Pets is paying for a service and
        also wether it is the Gold or Normal service, because only in this case its customers can access
        the Gold services from Packet Delivery.
    end note

    packetDeliveryAR->packetDeliveryPortal - -++: Send authorization data
    note over packetDeliveryPortal
        Reply can be Unauthorized, Normal or Gold, if Happy Pets is not paying for
        any service, for the Normal service or for the Gold service, respectively.
        We assume here that the reply is Gold.
    end note

    packetDeliveryPortal->packetDeliveryPortal: Calculate the services that this\ncustomer can access.\nIn this case, Gold services.
    packetDeliveryPortal- ->customerBrowser - -++: Refresh the screen with services for Gold customers\nand include <Access Token>

    note right customerBrowser
        At this point, Packet Delivery knows:
            1. That Happy Pets is a trusted participant entity
            2. That Happy Pets can issue credentials of type Gold (and also Normal)
            3. That happy Pets says that the user is a customer
            4. The category of customer (Normal/Gold)
            5. Any user info encoded into the VC, like customer id
    end note

    customerBrowser->packetDeliveryPEP - -++: Customer selects\n"Change PTA" on delivery order\nSend <Access Token>
    note over packetDeliveryPEP
        The Policy Enforcement Point (PEP) intercepts request and
        checks that the request includes an <Access Token> signed by Packet Delivery RP
    end note
    packetDeliveryPEP->packetDeliveryPEP: Validate\n<Access Token>
    note over packetDeliveryPEP
        The Policy Enforcement Point (PEP) intercepts request and asks the
        Policy Decision Point (PDP) to evaluate if the <Access Token>
        authorizes caller to access the target service ("Change PTA")
    end note

    packetDeliveryPEP->packetDeliveryPDP - -++: Evaluate authorisation request for "Change PTA"\nwith <Access Token>

    note over packetDeliveryPDP
        Use information in <Access Token> to evaluate policies associated to
        customer roles in the token.
    end note
    packetDeliveryPDP->packetDeliveryAR - -++: Evaluate authorisation\nof user evaluating policies\nassociated to roles
    packetDeliveryAR->packetDeliveryPDP - -++: User is authorised


    packetDeliveryPDP->packetDeliveryPEP - -++:Authorisation granted
    packetDeliveryPEP->packetDeliveryPortal - -++:Forward original request:\nChange PTA on delivery order\nwith <Access Token>

    packetDeliveryPortal->packetDeliveryPortal: Perform change\nRequest forwarded to\nContext Broker (not shown)
    packetDeliveryPortal->customerBrowser - -:Change confirmed

end group

@enduml

PlantUML version 1.2022.6(Tue Jun 21 19:34:49 CEST 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) Client VM
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>